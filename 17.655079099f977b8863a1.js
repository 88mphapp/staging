(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"/yFf":function(t,e,n){"use strict";var r=n("oHnp");function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.get=function(t){return this.header[t.toLowerCase()]},i.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=r.type(e);var n=r.params(e);for(var i in n)this[i]=n[i];this.links={};try{t.link&&(this.links=r.parseLinks(t.link))}catch(s){}},i.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t}},"24Ii":function(t,e,n){var r;"undefined"!=typeof window?r=window:"undefined"!=typeof self?r=self:(console.warn("Using browser-only version of superagent in non-browser environment"),r=this);var i=n("cpc2"),s=n("kMlx"),o=n("8zgK"),a=n("/yFf"),c=n("nZbv");function u(){}var l=e=t.exports=function(t,n){return"function"==typeof n?new e.Request("GET",t).end(n):1==arguments.length?new e.Request("GET",t):new e.Request(t,n)};e.Request=_,l.getXHR=function(){if(!(!r.XMLHttpRequest||r.location&&"file:"==r.location.protocol&&r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var h="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function d(t){if(!o(t))return t;var e=[];for(var n in t)p(e,n,t[n]);return e.join("&")}function p(t,e,n){if(null!=n)if(Array.isArray(n))n.forEach((function(n){p(t,e,n)}));else if(o(n))for(var r in n)p(t,e+"["+r+"]",n[r]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(n));else null===n&&t.push(encodeURIComponent(e))}function f(t){for(var e,n,r={},i=t.split("&"),s=0,o=i.length;s<o;++s)-1==(n=(e=i[s]).indexOf("="))?r[decodeURIComponent(e)]="":r[decodeURIComponent(e.slice(0,n))]=decodeURIComponent(e.slice(n+1));return r}function g(t){return/[\/+]json($|[^-\w])/.test(t)}function y(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=function(t){for(var e,n,r,i,s=t.split(/\r?\n/),o={},a=0,c=s.length;a<c;++a)-1!==(e=(n=s[a]).indexOf(":"))&&(r=n.slice(0,e).toLowerCase(),i=h(n.slice(e+1)),o[r]=i);return o}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.body=null===this.text&&t._responseType?this.xhr.response:"HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function _(t,e){var n=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",(function(){var t,e=null,r=null;try{r=new y(n)}catch(i){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=i,n.xhr?(e.rawResponse=void 0===n.xhr.responseType?n.xhr.responseText:n.xhr.response,e.status=n.xhr.status?n.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),n.callback(e)}n.emit("response",r);try{n._isResponseOK(r)||(t=new Error(r.statusText||"Unsuccessful HTTP response"))}catch(s){t=s}t?(t.original=e,t.response=r,t.status=r.status,n.callback(t,r)):n.callback(null,r)}))}function E(t,e,n){var r=l("DELETE",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}l.serializeObject=d,l.parseString=f,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":d,"application/json":JSON.stringify},l.parse={"application/x-www-form-urlencoded":f,"application/json":JSON.parse},a(y.prototype),y.prototype._parseBody=function(t){var e=l.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&g(this.type)&&(e=l.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},y.prototype.toError=function(){var t=this.req,e=t.method,n=t.url,r=new Error("cannot "+e+" "+n+" ("+this.status+")");return r.status=this.status,r.method=e,r.url=n,r},l.Response=y,i(_.prototype),s(_.prototype),_.prototype.type=function(t){return this.set("Content-Type",l.types[t]||t),this},_.prototype.accept=function(t){return this.set("Accept",l.types[t]||t),this},_.prototype.auth=function(t,e,n){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(n=e,e=""),n||(n={type:"function"==typeof btoa?"basic":"auto"});var r=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,n,r)},_.prototype.query=function(t){return"string"!=typeof t&&(t=d(t)),t&&this._query.push(t),this},_.prototype.attach=function(t,e,n){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,n||e.name)}return this},_.prototype._getFormData=function(){return this._formData||(this._formData=new r.FormData),this._formData},_.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var n=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),n(t,e)},_.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},_.prototype.buffer=_.prototype.ca=_.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},_.prototype.pipe=_.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},_.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},_.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||u,this._finalizeQueryString(),this._end()},_.prototype._end=function(){var t=this,e=this.xhr=l.getXHR(),n=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var n=e.readyState;if(n>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==n){var r;try{r=e.status}catch(i){r=0}if(!r){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var r=function(e,n){n.total>0&&(n.percent=n.loaded/n.total*100),n.direction=e,t.emit("progress",n)};if(this.hasListeners("progress"))try{e.onprogress=r.bind(null,"download"),e.upload&&(e.upload.onprogress=r.bind(null,"upload"))}catch(a){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(c){return this.callback(c)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof n&&!this._isHost(n)){var i=this._header["content-type"],s=this._serializer||l.serialize[i?i.split(";")[0]:""];!s&&g(i)&&(s=l.serialize["application/json"]),s&&(n=s(n))}for(var o in this.header)null!=this.header[o]&&this.header.hasOwnProperty(o)&&e.setRequestHeader(o,this.header[o]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==n?n:null),this},l.agent=function(){return new c},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(t){c.prototype[t.toLowerCase()]=function(e,n){var r=new l.Request(t,e);return this._setDefaults(r),n&&r.end(n),r}})),c.prototype.del=c.prototype.delete,l.get=function(t,e,n){var r=l("GET",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},l.head=function(t,e,n){var r=l("HEAD",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},l.options=function(t,e,n){var r=l("OPTIONS",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},l.del=E,l.delete=E,l.patch=function(t,e,n){var r=l("PATCH",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},l.post=function(t,e,n){var r=l("POST",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},l.put=function(t,e,n){var r=l("PUT",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}},"4Mn8":function(t,e,n){const r=n("pzNo");t.exports={Client:r}},"6WMX":function(t,e,n){const r=n("B3Rj"),i=n("b3gk"),s=n("tjlA").Buffer,o=n("L21C"),a=s.from("01","hex"),{HARDENED_OFFSET:c}=n("L21C"),u=[44+c,c,c,1,0],l={LEGACY:0,SEGWIT:5,TESTNET:111,SEGWIT_TESTNET:196};e.addressVersion=l;const h={P2PKH:1,P2SH:2,P2SH_P2WPKH:3};function d(t,e){return s.concat([t,e])}function p(t){const e=s.alloc(4);return e.writeUInt32LE(t),e}function f(t){let e;return t<253?(e=s.alloc(1),e.writeUInt8(t)):t<=65535?(e=s.alloc(3),e.writeUInt8(253,0),e.writeUInt16LE(t,1)):t<4294967295?(e=s.alloc(5),e.writeUInt8(254,0),e.writeUInt32LE(t,1)):(e=s.alloc(9),e.writeUInt8(255,0),e.writeUInt32LE(t>>>0,1),e.writeUInt32LE(t/4294967296|0,5)),e}function g(t,e,n){"number"==typeof t&&(t=t.toString(16));const r=s.alloc(8),i=t.length%2==0?t.toString(16):"0"+t.toString(16);return s.from(i,"hex").reverse().copy(r,0),r.copy(e,n),r}e.scriptTypes=h,e.buildBitcoinTxRequest=function(t){try{const{prevOuts:e,recipient:n,value:a,changePath:c=u,fee:d,isSegwit:p,changeVersion:f="SEGWIT"}=t;if(5!==c.length)throw new Error("Please provide a full change path.");const y=s.alloc(59+69*e.length);let _=0;if(void 0===l[f])throw new Error("Invalid change version specified.");y.writeUInt8(l[f]),_++,y.writeUInt32LE(c.length,_),_+=4;for(let t=0;t<c.length;t++)y.writeUInt32LE(c[t],_),_+=4;y.writeUInt32LE(d,_),_+=4;const E=r.decode(n)[0],m=i.decode(n).slice(1);y.writeUInt8(E,_),_++,m.copy(y,_),_+=m.length,g(a,y,_),_+=8,y.writeUInt8(e.length,_),_++;let v=0;const w=!0===p?h.P2SH_P2WPKH:h.P2PKH;return e.forEach(t=>{if(!t.signerPath||5!==t.signerPath.length)throw new Error("Full recipient path not specified ");y.writeUInt32LE(t.signerPath.length,_),_+=4;for(let e=0;e<t.signerPath.length;e++)y.writeUInt32LE(t.signerPath[e],_),_+=4;y.writeUInt32LE(t.index,_),_+=4,g(t.value,y,_),_+=8,v+=t.value,y.writeUInt8(w,_),_++,s.isBuffer(t.txHash)||(t.txHash=s.from(t.txHash,"hex")),t.txHash.copy(y,_),_+=t.txHash.length}),{payload:y,schema:o.signingSchema.BTC_TRANSFER,origData:t,changeData:{changeVersion:f,value:v-(a+d)}}}catch(e){return{err:e}}},e.serializeTx=function(t){const{inputs:e,outputs:n,isSegwitSpend:o,lockTime:c=0,crypto:u}=t;let h=s.alloc(4),y=0;h.writeUInt32LE(2,y),y+=4,!0===o&&(h=d(h,s.from("00","hex")),h=d(h,s.from("01","hex")));const _=f(e.length);h=d(h,_),y+=_.length,e.forEach(t=>{h=d(h,t.hash.reverse()),y+=t.hash.length;const e=p(t.index);if(h=d(h,e),y+=e.length,!0===o){const e=function(t,e){const n=s.alloc(22),r=e.createHash("sha256").update(t).digest(),i=e.createHash("rmd160").update(r).digest();return n.writeUInt8(0),n.writeUInt8(i.length,1),i.copy(n,2),n}(t.pubkey,u),n=f(e.length),r=s.concat([n,e]),i=f(r.length);h=d(h,i),y+=i.length,h=d(h,r),y+=r.length}else{const e=function(t,e){const n=f((t=s.concat([t,a])).length),r=f(e.length),i=s.concat([n,t,r,e]),o=f(i.length);return s.concat([o,i])}(t.sig,t.pubkey);h=d(h,e),y+=e.length}const n=p(4294967295);h=d(h,n),y+=n.length});const E=f(n.length);if(h=d(h,E),y+=E.length,n.forEach(t=>{const e=function(t){const e=s.alloc(8);return g(t,e,0),e}(t.value);h=d(h,e),y+=e.length;const n=function(t){const e=r.decode(t)[0],n=i.decode(t).slice(1);return e===l.SEGWIT||e===l.SEGWIT_TESTNET?function(t){const e=s.alloc(3+t.length);let n=0;return e.writeUInt8(169,n),n++,e.writeUInt8(t.length,n),n++,t.copy(e,n),n+=t.length,e.writeUInt8(135,n),n++,e}(n):function(t){const e=s.alloc(5+t.length);let n=0;return e.writeUInt8(118,n),n++,e.writeUInt8(169,n),n++,e.writeUInt8(t.length,n),n++,t.copy(e,n),n+=t.length,e.writeUInt8(136,n),n++,e.writeUInt8(172,n),n++,e}(n)}(t.recipient),o=f(n.length);h=d(h,o),y+=o.length,h=d(h,n),y+=n.length}),!0===o){const t=[],n=[];for(let i=0;i<e.length;i++)t.push(e[i].sig),n.push(e[i].pubkey);const r=function(t,e){let n=s.alloc(0);const r=s.alloc(1);r.writeUInt8(2);for(let i=0;i<t.length;i++){const o=s.concat([t[i],a]),c=f(o.length),u=e[i],l=f(u.length);n=s.concat([n,r,c,o,l,u])}return n}(t,n);h=d(h,r),y+=r.length}return s.concat([h,p(c)]).toString("hex")},e.getBitcoinAddress=function(t,e){return i.encode(s.concat([s.from([e]),t]))}},"8zgK":function(t,e,n){"use strict";t.exports=function(t){return null!==t&&"object"==typeof t}},L21C:function(t,e){const n={finalizePair:0,getAddresses:1290,sign:1090,getWallets:142,test:1646};let r=0;Object.keys(n).forEach(t=>{n[t]+82>r&&(r=n[t]+82)});const i={RESP_SUCCESS:0,RESP_ERR_INVALID_MSG:128,RESP_ERR_UNSUPPORTED_VER:129,RESP_ERR_DEV_BUSY:130,RESP_ERR_USER_TIMEOUT:131,RESP_ERR_USER_DECLINED:132,RESP_ERR_PAIR_FAIL:133,RESP_ERR_PAIR_DISABLED:134,RESP_ERR_PERMISSION_DISABLED:135,RESP_ERR_INTERNAL:136,RESP_ERR_GCE_TIMEOUT:137,RESP_ERR_WALLET_NOT_PRESENT:138,RESP_ERR_DEV_LOCKED:139,RESP_ERR_DISABLED:140};t.exports={ADDR_STR_LEN:129,AES_IV:[109,121,115,101,99,114,101,116,112,97,115,115,119,111,114,100],BASE_URL:"https://signing.gridpl.us",ENC_MSG_LEN:r,addressSizes:{BTC:20,ETH:20},decResLengths:n,deviceCodes:{CONNECT:1,ENCRYPTED_REQUEST:2},encReqCodes:{FINALIZE_PAIRING:0,GET_ADDRESSES:1,ADD_PERMISSION:2,SIGN_TRANSACTION:3,GET_WALLETS:4,TEST:5},ethMsgProtocol:{SIGN_PERSONAL:0},messageConstants:{NOT_PAIRED:0,PAIRED:1},responseCodes:i,responseMsgs:{[i.RESP_SUCCESS]:0,[i.RESP_ERR_INVALID_MSG]:"Invalid Request",[i.RESP_ERR_UNSUPPORTED_VER]:"Unsupported Version",[i.RESP_ERR_DEV_BUSY]:"Device Busy",[i.RESP_ERR_USER_TIMEOUT]:"Timeout Waiting for User",[i.RESP_ERR_USER_DECLINED]:"Request Declined by User",[i.RESP_ERR_PAIR_FAIL]:"Pairing Failed",[i.RESP_ERR_PAIR_DISABLED]:"Pairing is Currently Disabled",[i.RESP_ERR_PERMISSION_DISABLED]:"Automated Signing is Currently Disabled",[i.RESP_ERR_INTERNAL]:"Device Error",[i.RESP_ERR_GCE_TIMEOUT]:"Timeout",[i.RESP_ERR_WALLET_NOT_PRESENT]:"Incorrect Wallet UID Provided",[i.RESP_ERR_DEV_LOCKED]:"Device Locked",[i.RESP_ERR_DISABLED]:"Disabled"},signingSchema:{BTC_TRANSFER:0,ETH_TRANSFER:1,ERC20_TRANSFER:2,ETH_MSG:3},ETH_DATA_MAX_SIZE:1024,ETH_MSG_MAX_SIZE:1024,REQUEST_TYPE_BYTE:2,VERSION_BYTE:1,HARDENED_OFFSET:2147483648}},PLHu:function(t,e,n){const{buildBitcoinTxRequest:r}=n("6WMX"),{buildEthereumTxRequest:i,buildEthereumMsgRequest:s}=n("xKF7"),o=n("tjlA").Buffer,a=n("cke4"),c=n("cC09"),u=n("MzeL"),{AES_IV:l,responseCodes:h,responseMsgs:d,VERSION_BYTE:p}=n("L21C"),f=new(0,u.ec)("p256");function g(t){return c.buf(t)>>>0}t.exports={signReqResolver:{BTC:r,ETH:i,ETH_MSG:s},aes256_decrypt:function(t,e){const n=o.from(l),r=new a.ModeOfOperation.cbc(e,n);return o.from(r.decrypt(t))},aes256_encrypt:function(t,e){const n=o.from(l),r=new a.ModeOfOperation.cbc(e,n),i=t.length%16==0?t:a.padding.pkcs7.pad(t);return o.from(r.encrypt(i))},parseDER:function(t){if(48!==t[0]||2!==t[2])return null;let e=3;const n={r:null,s:null},r=t[e];if(e++,n.r=t.slice(e,e+r),e+=r,2!==t[e])return null;e++;const i=t[e];return e++,n.s=t.slice(e,e+i),n},checksum:g,parseLattice1Response:function(t){const e={err:null,data:null},n=o.from(t,"hex");let r=0;const i=n.readUInt8(r);if(r++,i!==p)return e.err="Incorrect protocol version. Please update your SDK",e;const s=n.readUInt8(r);if(r++,0!==s)return e.err="Incorrect response from Lattice1",e;n.readUInt32BE(r),r+=4;const a=n.readUInt16BE(r);r+=2;const c=n.slice(r,r+a);r+=a;const u=c.readUInt8(0);return u!==h.RESP_SUCCESS?(e.err="Error from device: "+(d[u]?d[u]:"Unknown Error"),e.responseCode=u,e):(e.data=c.slice(1,c.length),n.readUInt32BE(r)!==g(n.slice(0,n.length-4))?(e.err="Invalid checksum from device response",e.data=null,e):e)},getP256KeyPair:function(t){return f.keyFromPrivate(t,"hex")},getP256KeyPairFromPub:function(t){return f.keyFromPublic(t,"hex")},toPaddedDER:function(t){const e=o.alloc(74);return o.from(t.toDER()).copy(e),e}}},RP9m:function(t,e,n){const r=n("9lTW"),i=n("tjlA").Buffer;function s(t,e){if("00"===t.slice(0,2))throw new Error("invalid RLP: extra zeros");return parseInt(t,e)}function o(t,e){if(t<56)return new i([t+e]);var n=c(t),r=c(e+55+n.length/2);return new i(r+n,"hex")}function a(t){return"0x"===t.slice(0,2)}function c(t){var e=t.toString(16);return e.length%2&&(e="0"+e),e}function u(t){if(!i.isBuffer(t))if("string"==typeof t)t=a(t)?new i(((n="string"!=typeof(r=t)?r:a(r)?r.slice(2):r).length%2&&(n="0"+n),n),"hex"):new i(t);else if("number"==typeof t)t?(e=c(t),t=new i(e,"hex")):t=new i([]);else if(null==t)t=new i([]);else{if(!t.toArray)throw new Error("invalid type");t=new i(t.toArray())}var e,n,r;return t}e.encode=function(t){if(t instanceof Array){for(var n=[],r=0;r<t.length;r++)n.push(e.encode(t[r]));var s=i.concat(n);return i.concat([o(s.length,192),s])}return 1===(t=u(t)).length&&t[0]<128?t:i.concat([o(t.length,128),t])},e.decode=function(t,e){if(!t||0===t.length)return new i([]);var n=function t(e){var n,r,o,a,c,u=[],l=e[0];if(l<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(l<=183){if(n=l-127,o=128===l?new i([]):e.slice(1,n),2===n&&o[0]<128)throw new Error("invalid rlp encoding: byte must be less 0x80");return{data:o,remainder:e.slice(n)}}if(l<=191){if(n=s(e.slice(1,r=l-182).toString("hex"),16),(o=e.slice(r,n+r)).length<n)throw new Error("invalid RLP");return{data:o,remainder:e.slice(n+r)}}if(l<=247){for(a=e.slice(1,n=l-191);a.length;)c=t(a),u.push(c.data),a=c.remainder;return{data:u,remainder:e.slice(n)}}var h=(r=l-246)+(n=s(e.slice(1,r).toString("hex"),16));if(h>e.length)throw new Error("invalid rlp: total length is larger than the data");if(0===(a=e.slice(r,h)).length)throw new Error("invalid rlp, List has a invalid length");for(;a.length;)c=t(a),u.push(c.data),a=c.remainder;return{data:u,remainder:e.slice(h)}}(t=u(t));return e?n:(r.equal(n.remainder.length,0,"invalid remainder"),n.data)},e.getLength=function(t){if(!t||0===t.length)return new i([]);var e=(t=u(t))[0];if(e<=127)return t.length;if(e<=183)return e-127;if(e<=191)return e-182;if(e<=247)return e-191;var n=e-246;return n+s(t.slice(1,n).toString("hex"),16)}},cC09:function(t,e,n){var r;r=function(t){t.version="1.2.0";var e=function(){for(var t=0,e=new Array(256),n=0;256!=n;++n)e[n]=t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=n)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1;return"undefined"!=typeof Int32Array?new Int32Array(e):e}();t.table=e,t.bstr=function(t,n){for(var r=-1^n,i=t.length-1,s=0;s<i;)r=(r=r>>>8^e[255&(r^t.charCodeAt(s++))])>>>8^e[255&(r^t.charCodeAt(s++))];return s===i&&(r=r>>>8^e[255&(r^t.charCodeAt(s))]),-1^r},t.buf=function(t,n){if(t.length>1e4)return function(t,n){for(var r=-1^n,i=t.length-7,s=0;s<i;)r=(r=(r=(r=(r=(r=(r=(r=r>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])];for(;s<i+7;)r=r>>>8^e[255&(r^t[s++])];return-1^r}(t,n);for(var r=-1^n,i=t.length-3,s=0;s<i;)r=(r=(r=(r=r>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])])>>>8^e[255&(r^t[s++])];for(;s<i+3;)r=r>>>8^e[255&(r^t[s++])];return-1^r},t.str=function(t,n){for(var r,i,s=-1^n,o=0,a=t.length;o<a;)(r=t.charCodeAt(o++))<128?s=s>>>8^e[255&(s^r)]:r<2048?s=(s=s>>>8^e[255&(s^(192|r>>6&31))])>>>8^e[255&(s^(128|63&r))]:r>=55296&&r<57344?(r=64+(1023&r),i=1023&t.charCodeAt(o++),s=(s=(s=(s=s>>>8^e[255&(s^(240|r>>8&7))])>>>8^e[255&(s^(128|r>>2&63))])>>>8^e[255&(s^(128|i>>6&15|(3&r)<<4))])>>>8^e[255&(s^(128|63&i))]):s=(s=(s=s>>>8^e[255&(s^(224|r>>12&15))])>>>8^e[255&(s^(128|r>>6&63))])>>>8^e[255&(s^(128|63&r))];return-1^s}},"undefined"==typeof DO_NOT_EXPORT_CRC?r(e):r({})},cpc2:function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if((n=r[i])===e||n.fn===e){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},kMlx:function(t,e,n){"use strict";var r=n("8zgK");function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(t){return this._parser=t,this},i.prototype.responseType=function(t){return this._responseType=t,this},i.prototype.serialize=function(t){return this._serializer=t,this},i.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},i.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var s=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var n=this._retryCallback(t,e);if(!0===n)return!0;if(!1===n)return!1}catch(r){console.error(r)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~s.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(t,e){if(!this._fullfilledPromise){var n=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(t,e){n.end((function(n,r){n?e(n):t(r)}))}))}return this._fullfilledPromise.then(t,e)},i.prototype.catch=function(t){return this.then(void 0,t)},i.prototype.use=function(t){return t(this),this},i.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},i.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},i.prototype.getHeader=i.prototype.get=function(t){return this._header[t.toLowerCase()]},i.prototype.set=function(t,e){if(r(t)){for(var n in t)this.set(n,t[n]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},i.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},i.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),r(t)){for(var n in t)this.field(n,t[n]);return this}if(Array.isArray(e)){for(var i in e)this.field(t,e[i]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=""+e),this._getFormData().append(t,e),this},i.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},i.prototype._auth=function(t,e,n,r){switch(n.type){case"basic":this.set("Authorization","Basic "+r(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},i.prototype.withCredentials=function(t){return null==t&&(t=!0),this._withCredentials=t,this},i.prototype.redirects=function(t){return this._maxRedirects=t,this},i.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(t){var e=r(t),n=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(e&&r(this._data))for(var i in t)this._data[i]=t[i];else"string"==typeof t?(n||this.type("form"),this._data="application/x-www-form-urlencoded"==(n=this._header["content-type"])?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)||n||this.type("json"),this},i.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},i.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var n=this.url.substring(e+1).split("&");"function"==typeof this._sort?n.sort(this._sort):n.sort(),this.url=this.url.substring(0,e)+"?"+n.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(t,e,n){if(!this._aborted){var r=new Error(t+e+"ms exceeded");r.timeout=e,r.code="ECONNABORTED",r.errno=n,this.timedout=!0,this.abort(),this.callback(r)}},i.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))}},lGYU:function(t,e,n){(function(e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=n("HEbw"),h=n("+qE3").EventEmitter,d=n("4Mn8"),p="Lattice Hardware",f=2147483648,g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(g,t);var n,r,s,h=(r=g,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=u(r);if(s){var n=u(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return c(this,t)});function g(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(this,g),(t=h.call(this)).type=p,t._resetDefaults(),t.deserialize(e),t}return(n=[{key:"deserialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.creds&&(this.creds=t.creds),t.accounts&&(this.accounts=t.accounts),t.walletUID&&(this.walletUID=t.walletUID),t.name&&(this.name=t.name),t.network&&(this.network=t.network),Promise.resolve()}},{key:"serialize",value:function(){return Promise.resolve({creds:this.creds,accounts:this.accounts,walletUID:this.walletUID,name:this.name,network:this.network})}},{key:"isUnlocked",value:function(){return this._hasCreds()&&this._hasSession()}},{key:"setHdPath",value:function(){console.warn("setHdPath not implemented.")}},{key:"unlock",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((function(n,r){t._getCreds().then((function(e){return e&&(t.creds.deviceID=e.deviceID,t.creds.password=e.password),t._initSession()})).then((function(){return t._connect(e)})).then((function(){return n("Unlocked")})).catch((function(t){return r(Error(t))}))}))}},{key:"addAccounts",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(n,r){t.unlock().then((function(){return t._fetchAddresses(e,t.unlockedAccount)})).then((function(r){var s;return t.accounts.splice(t.unlockedAccount,e),(s=t.accounts).splice.apply(s,[t.unlockedAccount,0].concat(i(r))),n(t.accounts)})).catch((function(t){return r(t)}))}))}},{key:"getAccounts",value:function(){return Promise.resolve(this.accounts?this.accounts.slice():[].slice())}},{key:"signTransaction",value:function(t,n){var r=this;return new Promise((function(i,s){r._unlockAndFindAccount(t).then((function(t){var e={chainId:n.getChainId(),nonce:Number("0x".concat(n.nonce.toString("hex")))||0,gasPrice:Number("0x".concat(n.gasPrice.toString("hex"))),gasLimit:Number("0x".concat(n.gasLimit.toString("hex"))),to:"0x".concat(n.to.toString("hex")),value:Number("0x".concat(n.value.toString("hex"))),data:0===n.data.length?null:"0x".concat(n.data.toString("hex")),signerPath:[2147483692,2147483708,f,0,t]};return r._signTxData(e)})).then((function(t){return t.sig&&t.sig.v&&t.sig.r&&t.sig.s?(n.v=t.sig.v,n.r=e.from(t.sig.r,"hex"),n.s=e.from(t.sig.s,"hex"),i(n)):s(Error("No signature returned"))})).catch((function(t){return s(Error(t))}))}))}},{key:"signMessage",value:function(t,e){return console.warn("NOTE: signMessage is currently a proxy for signPersonalMessage!"),this.signPersonalMessage(t,e)}},{key:"signPersonalMessage",value:function(t,e){var n=this;return new Promise((function(r,i){n._unlockAndFindAccount(t).then((function(t){var s={currency:"ETH_MSG",data:{protocol:"signPersonal",payload:e,signerPath:[2147483692,2147483708,f,0,t]}};if(!n._hasSession())return i("No SDK session started. Cannot sign transaction.");n.sdkSession.sign(s,(function(t,e){if(t)return i(t);if(!e.sig)return i("No signature returned");var n=(e.sig.v-27).toString(16);return n.length<2&&(n="0".concat(n)),r("0x".concat(e.sig.r).concat(e.sig.s).concat(n))}))}))}))}},{key:"exportAccount",value:function(t){return Promise.reject(Error("exportAccount not supported by this device"))}},{key:"removeAccount",value:function(t){this.forgetDevice()}},{key:"getFirstPage",value:function(){return this.page=0,this._getPage(1)}},{key:"getNextPage",value:function(){return this.getFirstPage()}},{key:"getPreviousPage",value:function(){return this.getFirstPage()}},{key:"setAccountToUnlock",value:function(t){this.unlockedAccount=parseInt(t,10)}},{key:"forgetDevice",value:function(){this._resetDefaults()}},{key:"_unlockAndFindAccount",value:function(t){var e=this;return new Promise((function(n,r){e.unlock(!1).then((function(){return e.getAccounts()})).then((function(e){var i=null;return e.forEach((function(e,n){t.toLowerCase()===e.toLowerCase()&&(i=n)})),null===i?r("Signer not present"):n(i)})).catch((function(t){return r(t)}))}))}},{key:"_resetDefaults",value:function(){this.accounts=[],this.isLocked=!0,this.creds={deviceID:null,password:null},this.walletUID=null,this.sdkSession=null,this.page=0,this.unlockedAccount=0,this.network=null}},{key:"_getCreds",value:function(){var t=this;return new Promise((function(e,n){if(t._hasCreds())return e();var r=t.name?t.name:"Unknown",i="https://wallet.gridplus.io";t.network&&"mainnet"!==t.network&&(i="https://gridplus-web-wallet-dev.herokuapp.com");var s="".concat(i,"?keyring=").concat(r);t.network&&(s+="&network=".concat(t.network)),window.open(s).postMessage("GET_LATTICE_CREDS",i),window.addEventListener("message",(function(t){if(t.origin===i)try{var r=JSON.parse(t.data);return r.deviceID&&r.password?e(r):n(Error("Invalid credentials returned from Lattice."))}catch(s){return n(s)}}),!1)}))}},{key:"_connect",value:function(t){var e=this;return new Promise((function(n,r){e.sdkSession.connect(e.creds.deviceID,(function(i){if(i)return r(i);var s=e.sdkSession.getActiveWallet();if(!s||!s.uid)return r("No active wallet");var o=s.uid.toString("hex");if(o!=e.walletUID){if(!1===t)return r("Wallet has changed! Please reconnect.");e.accounts=[],e.walletUID=o}return n()}))}))}},{key:"_initSession",value:function(){var t=this;return new Promise((function(e,n){if(t._hasSession())return e();try{var r="https://signing.gridpl.us";t.network&&"mainnet"!==t.network&&(r="https://signing.staging-gridpl.us");var i={name:t.name,baseUrl:r,crypto:l,timeout:12e4,privKey:t._genSessionKey(),network:t.network};return t.sdkSession=new d.Client(i),e()}catch(s){return n(s)}}))}},{key:"_fetchAddresses",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(r,i){return t._hasSession()?n>t.accounts.length?i("Requested address is out of bounds. You may only request index <".concat(t.accounts.length)):t.accounts.length>n?r(t.accounts.slice(n,e)):void t.sdkSession.getAddresses({currency:"ETH",startPath:[2147483692,2147483708,f,0,n],n:e},(function(t,e){return t?i(Error("Error getting addresses: ".concat(t))):e.length<1?i("No addresses returned"):r(e)})):i("No SDK session started. Cannot fetch addresses.")}))}},{key:"_signTxData",value:function(t){var e=this;return new Promise((function(n,r){if(!e._hasSession())return r("No SDK session started. Cannot sign transaction.");e.sdkSession.sign({currency:"ETH",data:t},(function(t,e){return t?r(t):e.tx?n(e):r("No transaction payload returned.")}))}))}},{key:"_getPage",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(n,r){t.page+=e,t.page<=0&&(t.page=1);var i=5*(t.page-1);t.unlock().then((function(){return t._fetchAddresses(1,0)})).then((function(t){var e=[];return t.forEach((function(t,n){e.push({address:t,balance:null,index:i+n})})),n(e)})).catch((function(t){return r(t)}))}))}},{key:"_hasCreds",value:function(){return null!==this.creds.deviceID&&null!==this.creds.password&&this.name}},{key:"_hasSession",value:function(){return this.sdkSession&&this.walletUID}},{key:"_genSessionKey",value:function(){if(!this._hasCreds())throw new Error("No credentials -- cannot create session key!");var t=e.concat([e.from(this.creds.password),e.from(this.creds.deviceID),e.from(this.name)]);return l.createHash("sha256").update(t).digest()}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(g.prototype,n),g}(h);g.type=p,t.exports=g}).call(this,n("tjlA").Buffer)},nZbv:function(t,e){function n(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach((function(t){n.prototype[t]=function(){return this._defaults.push({fn:t,arguments:arguments}),this}})),n.prototype._setDefaults=function(t){this._defaults.forEach((function(e){t[e.fn].apply(t,e.arguments)}))},t.exports=n},oHnp:function(t,e,n){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce((function(t,e){var n=e.split(/ *= */),r=n.shift(),i=n.shift();return r&&i&&(t[r]=i),t}),{})},e.parseLinks=function(t){return t.split(/ *, */).reduce((function(t,e){var n=e.split(/ *; */),r=n[0].slice(1,-1);return t[n[1].split(/ *= */)[1].slice(1,-1)]=r,t}),{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},pzNo:function(t,e,n){const r=n("24Ii"),i=n("6WMX"),s=n("xKF7"),{signReqResolver:o,aes256_decrypt:a,aes256_encrypt:c,parseDER:u,checksum:l,getP256KeyPair:h,getP256KeyPairFromPub:d,parseLattice1Response:p,toPaddedDER:f}=n("PLHu"),{ADDR_STR_LEN:g,ENC_MSG_LEN:y,decResLengths:_,deviceCodes:E,encReqCodes:m,responseCodes:v,REQUEST_TYPE_BYTE:w,VERSION_BYTE:S,messageConstants:R,BASE_URL:T}=n("L21C"),b=n("tjlA").Buffer,P=b.alloc(32);t.exports=class{constructor({baseUrl:t,crypto:e,name:n,privKey:r,timeout:i,retryCount:s}={}){if(n&&n.length>24)throw new Error("name must be less than 24 characters");if(!e)throw new Error("crypto provider is required");this.baseUrl=t||T,this.crypto=e,this.name=n||"Unknown",this.privKey=r||this.crypto.randomBytes(32),this.key=h(this.privKey),this.ephemeralPub=null,this.sharedSecret=null,this.timeout=i||6e4,this.deviceId=null,this.isPaired=!1,this.retryCount=s||3,this.activeWallets={internal:{uid:P,name:null,capabilities:null,external:!1},external:{uid:P,name:null,capabilities:null,external:!0}}}connect(t,e){if("function"==typeof t){if(!this.deviceId)return e("No device ID has been stored. Please connect with your device ID first.");e=t}else this.deviceId=t;const n=this._buildRequest(E.CONNECT,this.pubKeyBytes());this._request(n,(t,n)=>t?e(t):(this.isPaired=this._handleConnect(n),this.isPaired?void this._getActiveWallet(t=>e(t,this.isPaired),!0):e(null)))}pair(t,e){const n=this.pubKeyBytes(),r=b.alloc(25);if(this.name.length>24)return e("Name is too many characters. Please change it to <25 characters.");r.write(this.name);const i=b.concat([n,r,b.from(t)]),s=this.crypto.createHash("sha256").update(i).digest(),o=this.key.sign(s),a=f(o),c=b.concat([r,a]),u=this._buildEncRequest(m.FINALIZE_PAIRING,c);this._request(u,(t,n)=>{if(t)return e(t);const r=this._handlePair(n);if(r)return e(r);this._getActiveWallet(t=>t?e(t):e(null,this.hasActiveWallet()),!0)})}test(t,e){if(!t.payload)return e("First argument must contain `testID` and `payload` fields.");const n=b.alloc(506);n.writeUInt32BE(t.testID,0),n.writeUInt16BE(t.payload.length,4),t.payload.copy(n,6);const r=this._buildEncRequest(m.TEST,n);this._request(r,(t,n)=>{if(t)return e(t);const r=this._handleEncResponse(n,_.test);return null!==r.err?e(r.err):e(null,r.data.slice(65))})}getAddresses(t,e){const{startPath:n,n:r}=t;if(void 0===n||void 0===r||5!==n.length)return e("Please provide `startPath` and `n` options");const i=b.alloc(33+4*n.length);let s=0;const o=this.getActiveWallet();if(null===o)return e("No active wallet.");o.uid.copy(i,s),s+=32;for(let c=0;c<n.length;c++)i.writeUInt32BE(n[c],s),s+=4;i.writeUInt8(r,s),s++;const a=this._buildEncRequest(m.GET_ADDRESSES,i);return this._request(a,(t,n)=>{if(t)return e(t);const r=this._handleGetAddresses(n);return r.err?e(r.err):e(null,r.data)})}sign(t,e){const{currency:n,data:r}=t;if(void 0===n||void 0===r)return e("Please provide `currency` and `data` options");if(void 0===o[n])return e("Unsupported currency");const i=o[n](r);if(void 0!==i.err)return e({err:i.err});if(i.payload.length>1152)return e("Transaction is too large");const s=b.alloc(1154);let a=0;s.writeUInt16BE(i.schema,a),a+=2;const c=this.getActiveWallet();if(null===c)return e("No active wallet.");c.uid.copy(s,a),a+=c.uid.length,i.payload.copy(s,a);const u=this._buildEncRequest(m.SIGN_TRANSACTION,s);return this._request(u,(r,s,o)=>{if(o===v.RESP_ERR_WALLET_NOT_PRESENT)this._getActiveWallet(n=>n?e(n):this.sign(t,e));else{if(!r){const t=this._handleSign(s,n,i);return e(t.err,t.data)}if(r)return e(r)}})}_getActiveWallet(t,e=!1){if(!0===e||!0!==this.hasActiveWallet()&&!0===this.isPaired){const e=b.alloc(0),n=this._buildEncRequest(m.GET_WALLETS,e);return this._request(n,(e,n)=>e?(this._resetActiveWallets(),t(e)):t(this._handleGetWallets(n)))}return t(null)}_getSharedSecret(){return b.from(this.key.derive(this.ephemeralPub.getPublic()).toArray("be",32))}_getEphemId(){if(null===this.ephemeralPub)return null;const t=this._getSharedSecret();return this.crypto.createHash("sha256").update(t).digest().slice(0,4)}_buildEncRequest(t,e){const n=parseInt(this._getEphemId().toString("hex"),16),r=b.concat([b.from([t]),e]),i=l(r),s=b.alloc(r.length+4);r.copy(s,0),s.writeUInt32LE(i,r.length);const o=this._getSharedSecret(),a=c(s,o),u=b.alloc(y+4);return u.writeUInt32LE(n,0),a.copy(u,4),this._buildRequest(E.ENCRYPTED_REQUEST,u)}_buildRequest(t,e){let n=e&&b.isBuffer(e)?e.length+1:1;t===E.ENCRYPTED_REQUEST&&(n=1+e.length);let r=0;const i=b.alloc(n+8);r=i.writeUInt8(S,r),r=i.writeUInt8(w,r);const s=this.crypto.randomBytes(4);r=i.writeUInt32BE(parseInt("0x"+s.toString("hex")),r),r=i.writeUInt16BE(n,r),r=i.writeUInt8(t,r),n>1&&(r=e.copy(i,r));const o=l(i),a=b.alloc(i.length+4);return r=i.copy(a),a.writeUInt32BE(o,r),a}_request(t,e,n=this.retryCount){if(!this.deviceId)return e("Serial is not set. Please set it and try again.");r.post(`${this.baseUrl}/${this.deviceId}`).timeout(this.timeout).send({data:t}).then(r=>{if(!r||!r.body)return e("Invalid response: "+r);if(200!==r.body.status)return e(`Error code ${r.body.status}: ${r.body.message}`);const i=p(r.body.message);return(i.responseCode===v.RESP_ERR_DEV_BUSY||i.responseCode===v.RESP_ERR_GCE_TIMEOUT)&&n>0?setTimeout(()=>{this._request(t,e,n-1)},3e3):(i.responseCode===v.RESP_ERR_WALLET_NOT_PRESENT&&this._resetActiveWallets(),i.err?e(i.err):e(null,i.data,i.responseCode))}).catch(t=>e("ECONNABORTED"===t.code&&"ETIME"===t.errno?"Timeout waiting for device. Please ensure it is connected to the internet and try again in a minute.":"Failed to make request to device."))}_handleConnect(t){let e=0;const n=t.readUInt8(e);e++;const r=t.slice(e,t.length).toString("hex");return this.ephemeralPub=d(r),n===R.PAIRED}_handleEncResponse(t,e){const n=this._getSharedSecret(),r=t.slice(0,y),i=a(r,n),s=i.slice(0,e+=65),o=parseInt("0x"+i.slice(e,e+4).toString("hex")),c=l(s);if(o!==c)return{err:`Checksum mismatch in response from Lattice (calculated ${c}, wanted ${o})`};const u=i.slice(0,65).toString("hex");try{return this.ephemeralPub=d(u),{err:null,data:i}}catch(h){return{err:"Error handling getAddresses response: "+h.toString()}}}_handlePair(t){const e=this._handleEncResponse(t,_.finalizePair);return e.err?e.err:(this.pairingSalt=null,this.isPaired=!0,null)}_handleGetAddresses(t){const e=this._handleEncResponse(t,_.getAddresses);if(null!==e.err)return e;const n=e.data;let r=65;const i=[];for(;r+4<_.getAddresses;){const t=n.slice(r,r+g);r+=g;const e=t.indexOf(0);e>0&&i.push(t.slice(0,e).toString())}return{data:i,err:null}}_handleGetWallets(t){const e=this._handleEncResponse(t,_.getWallets);if(null!==e.err)return e;const n=e.data;let r,i=65,s=!1;return r=n.slice(i,i+32),this.activeWallets.internal.uid=r,this.activeWallets.internal.capabilities=n.readUInt32BE(i+32),this.activeWallets.internal.name=n.slice(i+36,i+71),r.equals(P)||(s=!0),i+=71,r=n.slice(i,i+32),this.activeWallets.external.uid=r,this.activeWallets.external.capabilities=n.readUInt32BE(i+32),this.activeWallets.external.name=n.slice(i+36,i+71),r.equals(P)||(s=!0),!0===s?null:"No active wallet."}_handleSign(t,e,n=null){const r=this._handleEncResponse(t,_.sign);if(null!==r.err)return{err:r.err};let o=65;const a=r.data;let c;if("BTC"===e){const t=i.addressVersion[n.changeData.changeVersion],e=a.slice(o,o+20);o+=20,c=i.getBitcoinAddress(e,t)}const l={err:null,data:null};if("BTC"===e){const t=33,e=[],r=[];let s=0;for(;o<a.length&&48===a[o];)r.push(a.slice(o,o+2+a[o+1])),e.push(a.slice(s*t+825,(s+1)*t+825)),o+=74,s+=1;const u={inputs:[],outputs:[],isSegwitSpend:n.origData.isSegwit,network:n.origData.network,crypto:this.crypto};u.outputs.push({value:n.origData.value,recipient:n.origData.recipient}),n.changeData.value>0&&u.outputs.push({value:n.changeData.value,recipient:c});for(let i=0;i<r.length;i++)u.inputs.push({hash:n.origData.prevOuts[i].txHash,index:n.origData.prevOuts[i].index,sig:r[i],pubkey:e[i]});const h=i.serializeTx(u);let d=h;!0===u.isSegwitSpend&&(u.isSegwitSpend=!1,d=i.serializeTx(u));let p=this.crypto.createHash("sha256").update(b.from(d,"hex")).digest();p=this.crypto.createHash("sha256").update(p).digest().reverse().toString("hex"),l.data={tx:h,txHash:p,changeRecipient:c,sigs:r}}else if("ETH"===e){const t=u(a.slice(o,o+2+a[o+1]));o+=74;const e=a.slice(o,o+20),r=s.buildEthRawTx(n,t,e,n.useEIP155);l.data={tx:"0x"+r,txHash:"0x"+s.hashTransaction(r),sig:{v:t.v,r:t.r.toString("hex"),s:t.s.toString("hex")},signer:e}}else if("ETH_MSG"===e){const t=u(a.slice(o,o+2+a[o+1]));o+=74;const e=a.slice(o,o+20),r=s.validateEthereumMsgResponse({signer:e,sig:t},n);l.data={sig:{v:r.v,r:r.r.toString("hex"),s:r.s.toString("hex")},signer:e}}return l}_resetActiveWallets(){this.activeWallets.internal.uid=P,this.activeWallets.internal.name=null,this.activeWallets.internal.capabilities=null,this.activeWallets.external.uid=P,this.activeWallets.external.name=null,this.activeWallets.external.capabilities=null}getActiveWallet(){return P.equals(this.activeWallets.external.uid)?P.equals(this.activeWallets.internal.uid)?null:this.activeWallets.internal:this.activeWallets.external}hasActiveWallet(){return null!==this.getActiveWallet()}pubKeyBytes(t=!1){const e=this.key.getPublic().encode("hex"),n=b.from(e,"hex");if(!0===t){const t=n.slice(1,33).reverse(),e=n.slice(33,65).reverse();return b.concat([n[0],t,e])}return n}}},xKF7:function(t,e,n){const r=n("tjlA").Buffer,i=n("L21C"),s=n("HFX+").keccak256,o=n("RP9m"),a=n("IzB8");function c(t){let e=t[0];for(;t.length>0&&"0"===e.toString();)e=(t=t.slice(1))[0];return t}function u(t,e,n,i,o){try{const c=new Uint8Array(r.from(s(t),"hex"));e.v=27;const u=d(e.r,32);e.r=u;const l=d(e.s,32);e.s=l;const f=new Uint8Array(r.concat([u,l]));let g=a.ecdsaRecover(f,e.v-27,c,!1).slice(1);if(h(g)===n.toString("hex"))return!0===o&&(e.v=p(e.v,i)),e;if(e.v=28,g=a.ecdsaRecover(f,e.v-27,c,!1).slice(1),h(g)===n.toString("hex"))return!0===o&&(e.v=p(e.v,i)),e;throw new Error("Invalid Ethereum signature returned.")}catch(c){throw new Error(c)}}function l(t){return null===t||0===t?r.alloc(0):(r.isBuffer(t)&&(t=t.toString("hex")),"number"==typeof t?t=""+t.toString(16):"string"==typeof t&&"0x"===t.slice(0,2)&&(t=t.slice(2)),t.length%2>0&&(t="0"+t),r.from(t,"hex"))}function h(t){return s(t).slice(-40)}function d(t,e){const n=r.alloc(e);return t.length<e?(t.copy(n,e-t.length),n):t.slice(-e)}function p(t,e){return t+2*e+8}e.buildEthereumMsgRequest=function(t){if(!t.payload||!t.protocol||!t.signerPath)throw new Error("You must provide `payload`, `signerPath`, and `protocol` arguments in the messsage request");const e={schema:i.signingSchema.ETH_MSG,payload:null,input:t,msg:null};if("signPersonal"===t.protocol){let s=0;e.payload=r.alloc(4*(t.signerPath.length+1)+i.ETH_MSG_MAX_SIZE+4),e.payload.writeUInt8(i.ethMsgProtocol.SIGN_PERSONAL,0),s+=1,e.payload.writeUInt32LE(t.signerPath.length,s),s+=4;for(let n=0;n<t.signerPath.length;n++)e.payload.writeUInt32LE(t.signerPath[n],s),s+=4;let o=t.payload,a=!1;if("string"==typeof t.payload?"0x"===t.payload.slice(0,2)?(o=l(t.payload),a=!1===(n=o.toString(),/^[\x00-\x7F]*$/.test(n))):o=r.from(t.payload):"boolean"==typeof t.displayHex&&(a=t.displayHex),o.length>i.ETH_MSG_MAX_SIZE)throw new Error(`Your payload is ${o.length} bytes, but can only be a maximum of ${i.ETH_MSG_MAX_SIZE}`);return e.msg=o,e.payload.writeUInt8(a,s),s+=1,e.payload.writeUInt16LE(o.length,s),s+=2,o.copy(e.payload,s),e}throw new Error("Unsupported protocol");var n},e.validateEthereumMsgResponse=function(t,e){const{signer:n,sig:i}=t,{input:s,msg:o}=e;if("signPersonal"===s.protocol){const t=r.from("\x19Ethereum Signed Message:\n"+o.length.toString(),"utf-8");return u(r.concat([t,o]),i,n)}throw new Error("Unsupported protocol")},e.buildEthereumTxRequest=function(t){try{let{chainId:e=1}=t;const{signerPath:n}=t;if("number"!=typeof e&&(e=f[e]),!e)throw new Error("Unsupported chain name");if(!n||5!==n.length)throw new Error("Please provider full signer path (`signerPath`)");const s=g[e];t.value||(t.value=0);const o=[],a=l(t.nonce),c=l(t.gasPrice),u=l(t.gasLimit),h=l(t.to),d=l(t.value),p=l(t.data);o.push(a),o.push(c),o.push(u),o.push(h),o.push(d),o.push(p),!0===s&&(o.push(l(e)),o.push(l(null)),o.push(l(null)));const y=r.alloc(1146);let _=0;y.writeUInt8(Number(s),_),_++,y.writeUInt8(Number(e),_),_++,y.writeUInt32LE(n.length,_),_+=4;for(let t=0;t<n.length;t++)y.writeUInt32LE(n[t],_),_+=4;return y.writeUInt32BE(t.nonce,_),_+=4,function(t,e,n){"number"==typeof t&&(t=t.toString(16));const i=r.alloc(8),s=t.length%2==0?t.toString(16):"0"+t.toString(16),o=r.from(s,"hex");o.copy(i,i.length-o.length),i.copy(e,n)}(t.gasPrice,y,_),_+=8,y.writeUInt32BE(t.gasLimit,_),_+=4,h.copy(y,_),_+=20,d.copy(y,_+32-d.length),_+=32,p&&p.length>i.ETH_DATA_MAX_SIZE?{err:`Data field too large (must be <=${i.ETH_DATA_MAX_SIZE} bytes)`}:(y.writeUInt16BE(p.length,_),_+=2,p.copy(y,_),_+=1024,{rawTx:o,payload:y,schema:i.signingSchema.ETH_TRANSFER,chainId:e,useEIP155:s,signerPath:n})}catch(e){return{err:e.message}}},e.buildEthRawTx=function(t,e,n,i=!0){const s=u(o.encode(t.rawTx),e,n,t.chainId,i),a=t.rawTx.slice(0,6);return a.push(r.from(s.v.toString(16),"hex")),a.push(c(s.r)),a.push(c(s.s)),o.encode(a).toString("hex")},e.addRecoveryParam=u,e.hashTransaction=function(t){return s(r.from(t,"hex"))};const f={mainnet:1,roptsten:3,rinkeby:4,kovan:42,goerli:5},g={1:!0,3:!1,4:!1,42:!0,5:!0};e.chainIds=f}}]);